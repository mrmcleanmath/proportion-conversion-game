<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fraction • Decimal • Percent — Conversions</title>
<style>
  :root{
    --bg:#0b1020; --card:#111832; --ink:#e9edff; --muted:#a9b0d0;
    --accent:#6aa9ff; --ok:#4ddf7d; --bad:#ff6a6a; --border:#1b254d;
    --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,Segoe UI,Roboto,Arial,sans-serif}
  header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  header h1{font-size:18px;margin:0}
  .brand{opacity:.8;font-size:12px}
  main{max-width:1100px;margin:0 auto;padding:16px;display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:1000px){main{grid-template-columns:1.2fr .8fr}}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
  .pad{padding:16px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .seg{display:flex;border:1px solid var(--border);border-radius:12px;overflow:hidden}
  .seg button{background:transparent;color:var(--ink);border:0;padding:8px 12px;cursor:pointer}
  .seg button[aria-pressed="true"]{background:var(--accent);color:#06122a}
  .btn{background:#1a2652;color:var(--ink);border:1px solid var(--border);padding:10px 14px;border-radius:10px;cursor:pointer}
  .btn.secondary{background:transparent}
  .btn.good{background:#4ddf7d;color:#052715}
  .btn.warn{background:#ffd166;color:#3a2b00}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .prompt{font-size:28px;text-align:center;margin:10px 0 6px}
  .answer-row{display:flex;gap:8px;justify-content:center;align-items:center}
  input[type="text"]{background:#0c1430;border:1px solid var(--border);color:var(--ink);padding:12px 14px;border-radius:10px;min-width:280px;font-size:18px}
  .feedback{min-height:28px;text-align:center}
  .ok{color:var(--ok);font-weight:700}
  .no{color:var(--bad);font-weight:700}
  .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .tile{background:#0d1533;border:1px solid var(--border);padding:10px;border-radius:12px;text-align:center}
  .tile .big{font-size:22px;font-weight:700}
  footer{padding:16px 20px;border-top:1px solid var(--border);text-align:center;color:var(--muted)}
  /* Worksheet table */
  .ws-controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
  .table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--border);border-radius:12px;overflow:hidden}
  .table thead th{background:#0d1533;border-bottom:1px solid var(--border);padding:10px;font-size:18px}
  .table td{border-bottom:1px solid #143; border-right:1px solid #143; padding:14px 10px; text-align:center;min-height:46px}
  .table tr td:last-child{border-right:0}
  .blank{cursor:pointer;color:var(--muted)}
  .revealed{color:var(--ink)}
  .qmark{font-weight:800;font-size:20px;display:inline-flex;width:36px;height:36px;align-items:center;justify-content:center;border:1px solid var(--border);border-radius:10px;background:#0d1533;margin:auto}
  .hint{color:var(--muted);font-size:13px;margin-top:4px}
  .pill{padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#0d1533;font-size:12px}
  .panel{padding:12px;border:1px dashed var(--border);border-radius:12px;background:#0c1430}
  .sr-only{position:absolute;left:-9999px}
  .projector .prompt{font-size:40px}
  @media print{
    body{background:#fff;color:#000}
    .card,.panel{background:#fff;border-color:#000;box-shadow:none}
    header{display:none}
    .table td,.table th{border-color:#000}
    .blank{color:#000}
    footer{display:none}
  }
</style>
</head>
<body>
<header>
  <h1>Fraction • Decimal • Percent — Conversions</h1>
  <span class="brand">Created by Mr. McLean Math</span>
</header>

<main>
  <!-- GAME -->
  <section id="gameSec" class="card pad" aria-labelledby="gameTitle">
    <h2 id="gameTitle" class="sr-only">Game</h2>
    <div class="row">
      <div class="seg" role="tablist" aria-label="Mode">
        <button class="tabMode" data-mode="game" aria-pressed="true">Game</button>
        <button class="tabMode" data-mode="worksheet" aria-pressed="false">Worksheet</button>
      </div>
      <div class="seg" role="tablist" aria-label="Convert From">
        <button class="tabFrom" data-from="frac" aria-pressed="true">From Fraction</button>
        <button class="tabFrom" data-from="dec" aria-pressed="false">From Decimal</button>
        <button class="tabFrom" data-from="perc" aria-pressed="false">From Percent</button>
      </div>
      <div class="seg" role="tablist" aria-label="Options">
        <button id="projToggle" aria-pressed="false">Projector font</button>
        <button id="soundToggle" aria-pressed="true">Sound On</button>
      </div>
      <span class="pill">Enter=Submit/Next • Esc=Clear • No commas shown (dot for decimals)</span>
    </div>

    <div id="prompt" class="prompt" aria-live="polite">–</div>

    <div class="answer-row">
      <input id="answer" type="text" inputmode="decimal" autocomplete="off" placeholder="Type your answer…" aria-label="Your answer">
      <button id="submit" class="btn">Submit</button>
      <button id="clear" class="btn secondary">Clear</button>
      <button id="next" class="btn good" disabled>Next</button>
    </div>

    <div id="feedback" class="feedback" aria-live="polite"></div>
    <details id="stepsBox" class="panel" hidden>
      <summary>Show Steps</summary>
      <div id="steps"></div>
    </details>

    <div class="kpi">
      <div class="tile"><div class="muted">Score</div><div class="big" id="score">0</div></div>
      <div class="tile"><div class="muted">Streak</div><div class="big" id="streak">0</div></div>
      <div class="tile"><div class="muted">Accuracy</div><div class="big" id="acc">–</div></div>
    </div>
  </section>

  <!-- WORKSHEET (hidden until selected) -->
  <aside id="worksheet" class="card pad" style="display:none">
    <h3 class="sr-only">Worksheet</h3>
    <div id="wsControls" class="ws-controls">
      <label>Rows:
        <select id="wsSize"><option>5</option><option selected>10</option><option>15</option></select>
      </label>
      <button id="wsGen" class="btn">Generate</button>
      <button id="wsRevealAll" class="btn warn">Reveal all</button>
      <button id="wsHideAll" class="btn secondary">Hide all</button>
      <button id="wsPrint" class="btn secondary">Print</button>
    </div>
    <div class="panel"><strong>Worksheet instructions:</strong> Each row shows one given (Fraction, Decimal, or Percent). Fill in the two blanks. Click a “?” to reveal its answer. Fraction reveals show both <em>unsimplified</em> and <em>simplified</em> forms.</div>
    <table class="table" id="wsTable" aria-live="polite">
      <thead><tr><th>Fraction</th><th>Decimal</th><th>Percent</th></tr></thead>
      <tbody id="wsBody"></tbody>
    </table>
  </aside>
</main>

<footer>Created by Mr. McLean Math</footer>
<div aria-live="polite" class="sr-only" id="aria"></div>

<script>
/* ========= Formatting ========= */
const trimDec = s => s.replace(/(\.\d*?[1-9])0+$/,'$1').replace(/\.0+$/,'').replace(/\.$/,'');
const fmtDec = n => { let s=String(+n.toFixed(6)); if(s.includes('e')) s=Number(n).toFixed(6); return trimDec(s); };
const parseNumber = s => { const t=s.trim().replace(/\s+/g,'').replace(',', '.'); if(!/^[-+]?\d*\.?\d+$/.test(t)) return null; return Number(t); };
const decPlaces = x => { const s = trimDec(String(+x.toFixed(6))); const i = s.indexOf('.'); return i<0?0:(s.length-i-1); };

/* ========= Fractions ========= */
const gcd=(a,b)=>b?gcd(b,a%b):Math.abs(a);
const simp=(n,d)=>{ const g=gcd(n,d); return [n/g, d/g]; };
const fracEq=(a,b)=> a[0]*b[1]===a[1]*b[0];
const parseFrac = s => { const t=s.replace(/\s+/g,''); if(!/^-?\d+\/-?\d+$/.test(t)) return null; const [n,d]=t.split('/').map(Number); if(d===0) return null; return [n,d]; };
const fracStr = (n,d) => `${n}/${d}`;

/* ========= Beep ========= */
function beep(ok=true){
  if(document.getElementById('soundToggle').getAttribute('aria-pressed')!=='true') return;
  try{ const ac=new (window.AudioContext||window.webkitAudioContext)(), o=ac.createOscillator(), g=ac.createGain();
    o.type='sine'; o.frequency.value= ok?760:240; g.gain.value=.2; o.connect(g); g.connect(ac.destination); o.start(); o.stop(ac.currentTime+.18);
  }catch{}
}

/* ========= Random “nice” triples ========= */
const DENS = [2,4,5,8,10,20,25,40,50,80,100];
function makeTriple(){
  const d = DENS[Math.floor(Math.random()*DENS.length)];
  const n = Math.floor(Math.random()*(d-1))+1; // 1..d-1
  const [ns,ds] = simp(n,d);
  const dec = n/d;
  const perc = dec*100;
  return { rawFrac:[n,d], simpFrac:[ns,ds], dec, perc };
}

/* ========= GAME ========= */
const el=s=>document.querySelector(s), els=s=>Array.from(document.querySelectorAll(s));
let G={mode:'game', from:'frac', targetFlip:false, cur:null, score:0, streak:0, total:0, correct:0};

function setPressed(groupSel, btn){ els(groupSel).forEach(b=>b.setAttribute('aria-pressed', String(b===btn))); }
els('.tabMode').forEach(b=>b.addEventListener('click',()=>{
  G.mode=b.dataset.mode; setPressed('.tabMode',b);
  const ws=el('#worksheet'), game=el('#gameSec');
  if(G.mode==='game'){ ws.style.display='none'; game.style.display='block'; newProblem(true); }
  else { game.style.display='none'; ws.style.display='block'; generateWorksheet(); }
}));
els('.tabFrom').forEach(b=>b.addEventListener('click',()=>{ G.from=b.dataset.from; setPressed('.tabFrom',b); newProblem(true); }));

function newProblem(resetFlip=false){
  if(resetFlip) G.targetFlip=false;
  const t = makeTriple();
  let target;
  if (G.from==='frac'){ target = G.targetFlip ? 'dec' : 'perc'; }
  if (G.from==='dec'){  target = G.targetFlip ? 'frac': 'perc'; }
  if (G.from==='perc'){ target = G.targetFlip ? 'frac': 'dec'; }
  G.targetFlip = !G.targetFlip;

  let prompt='', answer=null, steps=[];
  if (G.from==='frac' && target==='dec'){
    prompt = `From fraction → Convert to decimal: ${fracStr(...t.rawFrac)}`;
    answer = fmtDec(t.dec);
    steps = [`Divide numerator by denominator: ${t.rawFrac[0]} ÷ ${t.rawFrac[1]} = ${fmtDec(t.dec)}.`];
  } else if (G.from==='frac' && target==='perc'){
    prompt = `From fraction → Convert to percent: ${fracStr(...t.rawFrac)}`;
    answer = `${trimDec(String((t.dec*100).toFixed(2)))}%`;
    steps = [`Multiply by 100 and add %: (${t.rawFrac[0]}/${t.rawFrac[1]}) × 100 = ${answer}.`];
  } else if (G.from==='dec' && target==='frac'){
    const dp = decPlaces(t.dec);
    const den = 10**dp; const num = Math.round(t.dec*den);
    const [n2,d2]=simp(num,den);
    prompt = `From decimal → Convert to fraction: ${fmtDec(t.dec)}`;
    answer = fracStr(n2,d2);
    steps = [`Write as ${num}/${den} and simplify ⇒ ${n2}/${d2}.`];
  } else if (G.from==='dec' && target==='perc'){
    prompt = `From decimal → Convert to percent: ${fmtDec(t.dec)}`;
    answer = `${trimDec(String((t.dec*100).toFixed(2)))}%`;
    steps = [`×100 and add % ⇒ ${answer}.`];
  } else if (G.from==='perc' && target==='frac'){
    const p = +trimDec(String(t.perc.toFixed(2)));             // e.g., 12.5
    const k = decPlaces(p);                                     // 0 or 1 (we allow half percents)
    const numU = Math.round(p * 10**k);                         // 125 for 12.5
    const denU = 100 * 10**k;                                   // 1000 for 12.5%
    const [n2,d2]=simp(numU,denU);
    prompt = `From percent → Convert to fraction: ${trimDec(String(p))}%`;
    answer = fracStr(n2,d2);
    steps = [`${p}% = ${p}/100 = ${numU}/${denU}.`, `Simplify ⇒ ${n2}/${d2}.`];
  } else { // perc -> dec
    const p = t.perc;
    prompt = `From percent → Convert to decimal: ${trimDec(String(p.toFixed(2)))}%`;
    answer = fmtDec(p/100);
    steps = [`Divide by 100 ⇒ ${answer}.`];
  }

  G.cur = {t, target, answer, steps, prompt};
  el('#prompt').textContent = prompt;
  el('#answer').value=''; el('#next').disabled=true;
  el('#feedback').textContent=''; el('#stepsBox').hidden=true; el('#steps').textContent='';
  el('#answer').focus();
}

function submitAnswer(){
  if(!G.cur) return;
  const raw = el('#answer').value.trim();
  if(!raw){ el('#answer').focus(); return; }

  let ok=false;
  if (G.from==='frac' && G.cur.target==='dec' || G.from==='perc' && G.cur.target==='dec'){
    const val = parseNumber(raw);
    ok = (val!==null) && Math.abs(val - Number(G.cur.answer)) < 1e-9;
  } else if (G.from==='dec' && G.cur.target==='perc' || G.from==='frac' && G.cur.target==='perc'){
    ok = /%$/.test(raw) && (trimDec(String(parseFloat(raw.replace('%','').replace(',','.')).toFixed(6))) + '%') === G.cur.answer;
  } else { // expecting fraction
    const u = parseFrac(raw), target = parseFrac(G.cur.answer);
    ok = !!u && !!target && fracEq(u,target);
  }

  G.total++;
  if(ok){
    G.correct++; G.streak++; G.score += 10 + (G.streak%5===0?5:0);
    el('#feedback').innerHTML = '<span class="ok">Correct!</span> Press Enter or click Next.'; el('#next').disabled=false; beep(true);
  }else{
    G.streak=0; el('#feedback').innerHTML = '<span class="no">Try again.</span> You can open “Show Steps.”';
    el('#steps').innerHTML = G.cur.steps.map(s=>'• '+s).join('\n') + `\nCorrect: ${G.cur.answer}`;
    el('#stepsBox').hidden=false; beep(false);
  }
  el('#score').textContent=G.score;
  el('#streak').textContent=G.streak;
  el('#acc').textContent = G.total? Math.round(100*G.correct/G.total)+'%' : '–';
}
function nextProblem(){ newProblem(); }
function clearAnswer(){ el('#answer').value=''; el('#answer').focus(); }
el('#submit').addEventListener('click',submitAnswer);
el('#next').addEventListener('click',nextProblem);
el('#clear').addEventListener('click',clearAnswer);
el('#answer').addEventListener('keydown',e=>{
  if(e.key==='Enter'){ if(!el('#next').disabled) nextProblem(); else submitAnswer(); }
  if(e.key==='Escape') clearAnswer();
});
el('#projToggle').addEventListener('click',e=>{
  const pressed = e.target.getAttribute('aria-pressed')==='true';
  e.target.setAttribute('aria-pressed', String(!pressed));
  document.documentElement.classList.toggle('projector', !pressed);
});
el('#soundToggle').addEventListener('click',e=>{
  const pressed = e.target.getAttribute('aria-pressed')==='true';
  e.target.setAttribute('aria-pressed', String(!pressed));
});

/* ========= WORKSHEET ========= */
function fracFromDecimalUnsimplified(x){
  const k = decPlaces(x);                       // number of decimal digits
  return [Math.round(x * 10**k), 10**k];        // e.g., 0.75 -> 75/100
}
function fracFromPercentUnsimplified(p){
  const k = decPlaces(p);                       // 12.5 -> k=1
  return [Math.round(p * 10**k), 100 * 10**k];  // 12.5% -> 125/1000
}

function wsRow(triple, givenType){
  const decStr  = fmtDec(triple.dec);
  const percStr = `${fmtDec(triple.perc)}%`;

  const tdF = document.createElement('td');
  const tdD = document.createElement('td');
  const tdP = document.createElement('td');

  function makeBlank(textWhenRevealed, extraNote){
    const span = document.createElement('div');
    span.className='blank qmark';
    span.setAttribute('role','button'); span.tabIndex=0; span.title='Click to reveal';
    span.textContent='?';
    const reveal = ()=>{ span.className='revealed'; span.innerHTML = textWhenRevealed + (extraNote? `<div class="hint">${extraNote}</div>` : ''); };
    span.addEventListener('click',reveal);
    span.addEventListener('keypress',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); reveal(); }});
    return span;
  }

  if (givenType==='frac'){
    tdF.textContent = `${triple.rawFrac[0]}/${triple.rawFrac[1]}`;
    tdD.appendChild(makeBlank(decStr));
    tdP.appendChild(makeBlank(percStr));
  } else if (givenType==='dec'){
    // Fraction reveal: UNSIMPLIFIED from decimal, then simplified
    const [nu,du] = fracFromDecimalUnsimplified(triple.dec);
    const [ns,ds] = simp(nu,du);
    tdD.textContent = decStr;
    tdF.appendChild(makeBlank(`${nu}/${du}`, `simplified: ${ns}/${ds}`));
    tdP.appendChild(makeBlank(percStr));
  } else { // given percent
    // Fraction reveal: UNSIMPLIFIED from percent-over-100/1000, then simplified
    const [nu,du] = fracFromPercentUnsimplified(triple.perc);
    const [ns,ds] = simp(nu,du);
    tdP.textContent = percStr;
    tdD.appendChild(makeBlank(decStr));
    tdF.appendChild(makeBlank(`${nu}/${du}`, `simplified: ${ns}/${ds}`));
  }
  const tr = document.createElement('tr');
  tr.appendChild(tdF); tr.appendChild(tdD); tr.appendChild(tdP);
  return tr;
}

function generateWorksheet(){
  const tbody = el('#wsBody'); tbody.innerHTML='';
  const n = parseInt(el('#wsSize').value,10);
  const types = ['frac','dec','perc']; let idx=0, tries=0;
  const used = new Set();
  while (tbody.children.length < n && tries < n*10){
    const t = makeTriple();
    const key = `${t.rawFrac[0]}/${t.rawFrac[1]}`;
    if(used.has(key)){ tries++; continue; }
    used.add(key);
    tbody.appendChild(wsRow(t, types[idx%3])); idx++; tries++;
  }
  while (tbody.children.length < n){
    const t = makeTriple();
    tbody.appendChild(wsRow(t, types[idx%3])); idx++;
  }
}
function wsRevealAll(){ el('#wsBody').querySelectorAll('.blank').forEach(b=>b.click()); }
function wsHideAll(){ el('#wsBody').querySelectorAll('.revealed').forEach(r=>{ r.className='blank qmark'; r.textContent='?'; r.title='Click to reveal'; }); }
function wsPrint(){ window.print(); }
el('#wsGen').addEventListener('click',generateWorksheet);
el('#wsRevealAll').addEventListener('click',wsRevealAll);
el('#wsHideAll').addEventListener('click',wsHideAll);
el('#wsPrint').addEventListener('click',wsPrint);

/* ========= Init ========= */
(function init(){
  newProblem(true);      // start in Game mode
  generateWorksheet();   // prebuild for quick switch
})();
</script>
</body>
</html>
